<template>
  <span>
    <v-menu offset-y>
      <template v-slot:activator="{ on }">
          <v-btn
          :color="color"
          v-on="on"
          rounded
          :small="small"
          :text="text"
          class='d-none d-sm-inline'
        >
      
          <v-icon x-small class='mr-2'>fas fa-share</v-icon> {{label}}
        </v-btn>
      </template>
      <v-list min-width="200">
        <v-list-item
          v-for="(item, index) in items"
          :key="index"
          @click="picked(item)"
          role="menuitem"
        >
          <v-list-item-title>{{ item.title }}</v-list-item-title>
        </v-list-item>
        
        <v-list-item v-if="showCopy" @click="copyURL">
          <v-list-item-title>{{copyText}}</v-list-item-title>
        </v-list-item>
      </v-list>
    </v-menu>
    <v-menu offset-y>
      <template v-slot:activator="{ on }">
          <v-btn
          :color="color"
          v-on="on"
          rounded
          fab 
          :x-small="small"
          class='d-inline d-sm-none'
        >
          <v-icon x-small>fas fa-share</v-icon>
          <span class='sr-only'>Share</span>
        </v-btn>
      </template>
      <v-list min-width="200">
        <v-list-item
          v-for="(item, index) in items"
          :key="index"
          @click="picked(item)"
          role="menuitem"
        >
          <v-list-item-title>{{ item.title }}</v-list-item-title>
        </v-list-item>

      <v-list-item v-if="showCopy" @click="copyURL">
          <v-list-item-title>{{copyText}}</v-list-item-title>
        </v-list-item>
      </v-list>
    </v-menu>
  </span>
</template>

<script>
import AnalyticsEvents from "vue/mixins/AnalyticsEvents.js";
import _ from 'lodash';
// import clipboard from 'clipboard';

export default {
    mixins: [AnalyticsEvents],
    props: {
        'url': { type: String, default: ''},
        'label': { type: String, default: 'Share' },
        'small': { type: Boolean, default: false },
        'text': {type: Boolean, default: false },
        'color': {type: String, default: 'secondary'},
        'hide': {type: Array, default: null},
        'showCopy': {type: Boolean, default: false},
        'copyText': {type:String, default: "Copy URL to Clipboard"}
    },
    computed: {
      items(){
        let shareOptions =  [
            { title: 'Twitter' , 'url': 'https://twitter.com/intent/tweet?text='+this.sentence+'&url='},
            { title: 'Facebook', 'url': 'https://www.facebook.com/sharer/sharer.php?u=' },
            { title: 'Email', 'url': 'mailto:?subject='+this.sentence.slice(0,-1)+'&body=I%20found%20this%20on%20collegescorecard.ed.gov.%20Take%20a%20look%3A%0A%0A' }, 
            { title: 'LinkedIn', 'url': 'https://www.linkedin.com/sharing/share-offsite/?url='},
        ];

        // Remove items that that should be hidden
        return shareOptions.filter((option) => {
          // Return if not in the hide prop array
          if(_.indexOf(this.hide, option.title.toLowerCase()) < 0){
            return option;
          }
        });

      },
      sentence(){
        let sentence = '';
        switch(this.label.toLowerCase())
        {
          case 'share':
            sentence = 'Take a look at this school search from the College Scorecard:';
          break;
          case 'share this comparison':
            sentence = 'Take a look at this school comparison on the College Scorecard:';
          break;
          case 'share this school':
            sentence = 'Take a look at this school on the College Scorecard:';
          break;
        }
        return sentence;
      }
    },
    methods:{
      picked(item){
          this.trackShare(item.title);
          window.open(item.url+this.url, "_blank");
      },
      copyURL(){
        this.$copyText(this.url);
      }
    }

}
</script>